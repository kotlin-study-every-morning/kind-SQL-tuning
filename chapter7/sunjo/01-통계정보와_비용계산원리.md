<aside>
💡 데이터베이스를 안정적으로 관리하기 위해서는 옵티마이저에 대한 이해가 필수이다.
선택도와 카디널리티, 통계정보 등을 배워보겠습니다.

</aside>

### 선택도와 카디널리티

---

**선택도란?(NVD)**

조건절에 의해 선택되는 레코드 비율입니다.

**카디널리티란?**

조건절에 의해 선택되는 레코드 개수입니다. (총 로우수 * 선택도)

⇒ 옵티마이저는 카디널리티를 구하고 데이터를 액세스 하는데 드는 비용을 계산해서 **테이블 액세스 방식, 조인 순서, 조인 방식** 등을 결정합니다.

### 통계 정보

---

통계 정보에는 오브젝트 통계(테이블 통계, 인덱스 통계, 컬럼 통계), 시스템 통계가 있다.

**통계 정보란?**

데이터베이스 마다 고유하게 존재하는 쿼리의 최적화와 실행계획을 작성하는 비용기반의 옵티마이저(Optimizer)가 참조하는 정보로 가장 필수적인 정보

**테이블 통계**

오라클 - dbms_stats.gather_table_stats, all_tab_statistics

mysql - innodb_index_stats 와 innodb_table_stats

**테이블 통계**

오라클 - dbms_stats.gather_index_stats, all_ind_statistics

mysql - mysql.innodb_index_stats

**컬럼 통계**

오라클 - all_tab_col_statistics

**컬럼 히스토리**

선택도를 잘못 구하면 데이터 액세스 비용을 잘못 산정하게 되고, 결국 최적이 아닌 실행계획으로 이어진다. - 그래서 히스토그램을 추가로 활용(도수 분포, 높이 균형, 상위도수분포, 하이브리드)

오라클 - method_opt

**시스템 통계**

어플리케이션 및 하드웨어 성능 특성을 측정한 것이며 어플리케이션 특성 및 동시 트랜잭션 발생량에 따라서도 이들 성능 특성이 달라진다.

- cpu 속도
- 평균 single block io 속도
- 평균 multi block io 속도
- 평균 multi block io 개수
- io 서브시스템의 최대 처리량
- 병렬 slave 평균 처리량

### 비용 계산 원리

---

1. 인덱스 키값을 모두 = 조건으로 검색할 때는 인덱스 통계만으로 비용 계산

   인덱스 수직 탐색 비용 + 인덱스 수평 탐색 비용 + 테이블 랜덤 액세스 비용

2. = 조건이 아닐 경우 컬럼 통계까지 활용

   인덱스 수직 탐색 비용 + 인덱스 수평 탐색 비용(leaf_block * 유효 인덱스 선택도) + 테이블 랜덤 액세스 비용(clustering_factor * 유효 테이블 선택도)


**유효 인덱스 선택도**

인덱스 레코드 중 액세스 조건에 의해 선택될 것으로 예상되는 레코드 비중을 의미합니다.

**유효 테이블 선택도**

레코드 중 인덱스 컬럼에 대한 모든 조건절에 의해 선택될 것으로 예상되는 레코드 비중을 의미한다.