### 소트 머지 조인

---

인덱스가 없을 경우, 대량 데이터여서 인덱스가 효과적이지 않을 때 사용한다.

### SGA vs PGA

---

SGA

- SGA에 캐시된 데이터는 여러 프로세스가 공유할 수 있다.
- 자신만의 고유 메모리 영역을 갖는다.
- 프로세스간 액세스를 직렬화하기 위한 lock 메커니즘으로 래치가 존재한다.

PGA

- 오라클 서버 프로세스에 할당된 메모리 영역
- 프로세스에 고유 데이터를 저장하는 용도
- 다른 프로세스와 공유하지 않는 독립적인 메모리 공간으로 래치 메커니즘이 불필요하다.
- 그래서 같은 양의 데이터를 읽더라도 SGA 보다 빠르다.

### 기본 메커니즘

---

1. 소트 단계 - 조인 컬럼 기준으로 정렬
2. 머지 단계 - 정렬한 양쪽 집합을 서로 머지한다.

```sql
select * from 사원 e, 고객 c
where e.입사일자 >= '19960101' 
and c.관리사원번호 = e.사원번호   
and e.부서코드 = 'z123'        
and c.최종구문금액 >= 20000
```

1. 사원번호순으로 정렬한다.
2. 조인 컬럼인 관리사원번호 순으로 정렬한다. - 정렬한 결과집합을 PGA영역에 할당된 sort area에 저장한다. 만약 너무 크다면 temp 테이블 스페이스에 저장한다.
3. PGA에 저장한 사원 데이터를 스캔하면서 PGA에 저장한 고객 데이터와 조인한다.

1, 2 - 소트단계, 3 - 머지단계

- 사원 데이터를 기준으로 고객 데이터를 매번 full scan 하지 않는다.
    - 즉 정렬돼 있으므로 조인 대상 레코드가 시작되는 지점을 쉽게 찾고 바로 멈춤
- 조인 컬럼에 인덱스가 없어도 사용할 수 있음

### 소트 머지 조인이 빠른 이유

---

- 소트 머지 조인은 sort area에 미리 정렬해 둔 자료구조를 이용
- nl 조인은 - DB 버퍼 캐시 ⇒ 모든 블록에 래치 획득 및 캐시 버퍼 체인 스캔 과정이 있다.
- 소트 머지 조인 - PGA에 저장한 후 조인

### 주용도

---

- 조인 조건식이 = 조건이 아닌 대량 데이터 조인
- 조인 조건식이 없는 조인